<!DOCTYPE html>
<html>
<head>
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1, maximum-scale=1"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta charset="utf-8"/>

    <title>chayns.js v4</title>

    <link rel="stylesheet" href="https://api.chayns.net/css/">
</head>
<body>
<div class="tapp">
    <div class="tapp__content">
        <h1>chayns API v4</h1>
        <button class="button" id="cursorFunction">WaitCursor</button>
        <button class="button" id="cursorCall">WaitCursor Call</button>
        <button class="button" id="globalCall">GlobalData Call</button>
        <button class="button" id="globalData">chayns.getGlobalData</button>
        <button class="button" id="consoleClear">Clear Console</button>
        <div class="content__card" id="console">
            <p id="0"></p>
        </div>
    </div>
</div>

<script src="chayns.js"></script>
<script>
    let cursorStatus = false;
    chayns.utils.setLevel(5);

    window.cursorFunction = () => {
        cursorStatus ? chayns.hideWaitCursor() : chayns.showWaitCursor();
        cursorStatus = !cursorStatus;
    };

    window.cursorCall = () => {
        cursorStatus = !cursorStatus;
        let waitcursor = {
            action: 1,
            value: {
                enabled: cursorStatus
            }
        };
        chayns.invokeCall(waitcursor);
    };

    window.globalDataTest = () => {
        chayns.getGlobalData().then(window.log);
    };

    window.globalCallTest = () => {
        const getGlobalData = {
            action: 18,
            value: {
                callback: "window.log",
                apiVersion: 4000
            },
            isWidget: true
        };
        chayns.invokeCall(getGlobalData);
    };

    let id = 1;

    window.clearConsole = () => {
        id = 0;
        let element = document.getElementById("console");
        element.innerHTML = '<p id="0"></p>';
    };

    window.log = (...args) => {
        args.forEach((arg) => {
            let para = document.createElement("p");
            let node = document.createTextNode(JSON.stringify(arg, null, 2));
            para.appendChild(node);
            para.setAttribute("id", (id + 1).toString());
            let element = document.getElementById("console");
            let child = document.getElementById(id.toString());
            element.insertBefore(para, child);
            id++;
        })
    };

    document.getElementById('consoleClear').addEventListener('click', window.clearConsole);
    document.getElementById('globalData').addEventListener('click', window.globalDataTest);
    document.getElementById('globalCall').addEventListener('click', window.globalCallTest);
    document.getElementById('beacon').addEventListener('click', window.beaconTest);
    document.getElementById('cursorCall').addEventListener('click', window.cursorCall);
    document.getElementById('cursorFunction').addEventListener('click', window.cursorFunction);

</script>
</body>
</html>
